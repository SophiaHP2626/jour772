---
title: "lab_07"
author: "Derek Willis/Rob Wells"
date: "2025-10-21"
output: html_document
---


Lab07 - API Keys and Tidycensus


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## You will need

-   A Census API key

## Load libraries and establish settings

You'll need to load two packages for this: the tidyverse and tidycensus.

**Task** load these two packages

```{r}
# Turn off scientific notation
options(scipen=999)
library(tidycensus)
library(janitor)
library(tidyverse)
library(lubridate)
install.packages("usethis")
# Load the tidyverse.
```

## Security and API keys

You'll need your Census API Key. Here's how to do that securely:

r_environ is a hidden file that can securely store API keys
```{r}
usethis::edit_r_environ()
# a new text file opens in RStudio
```

1. Add your API keys in the r_environ file
CENSUS_API_KEY=XXXXX
OPENAI_API_KEY=XXXX
etc....

2. Save the r_environ() file and RESTART R

# Hide your API Key from GitHub

```{r}
# Check if .gitignore exists in your project
file.exists(".gitignore")
```

Assuming you don't have a .gitignore file, then create one
1. RStudio:
- File → New File → Text File

2. ## Add These Lines to Your `.gitignore`
# R files
.Rhistory
.RData
.Rproj.user/
.Renviron
.Rprofile

# Environment files
.env
*.env

# API keys and secrets
*secret*
*password*
*api_key*

3. save the file a .gitignore in the root directory of your project
yes, you have to precede the file with a dot: .gitignore

4. Veryify it is working

```{r}
system("git status")
```


## Setup Census API

You'll need your Census API Key:

**Task** set your API Key if you haven't already. You won't need to install or overwrite it.

```{r echo=FALSE}
census_api_key("4bdc2640d2614eaf426a459330895d8dab492adf", install=TRUE)
```

## Load and view ACS variables

You'll also need to load the list of American Community Survey variables from the 2023 5-year estimates so you can identify the codes you need:

**Task** load the variables from the 2023 5-year ACS (which is called "acs5") and save them to a dataframe

```{r}
acs_var_2023 <- load_variables (year= 2023,
                                dataset = "acs5",
                                cache=TRUE)
acs_vars_2023 <- acs_var_2023 |>
  clean_names()
glimpse(acs_vars_2023)
```

## Answer questions

**Q1** What is the Maryland jurisdiction with the lowest median age, according to the ACS 2023 5-year estimates? Hint: look at the variables for ACS in 2023 and find the variable for median age. **A1**

```{r}
median_age_vars <- acs_vars_2023 |>
  filter(str_detect(label, regex("median age", ignore_case = TRUE)))

md_median_age <- get_acs(
  geography = "county",
  variables = "B01002_001",
  state = "MD",
  year = 2023,
  survey = "acs5"
) |>
  clean_names()

md_median_age_stored <- md_median_age |>
  arrange(estimate)

```

**Q2** Which Maryland counties have a median age of at least 50? You can use the dataframe created in Q1 to answer this, but you must write code to display only those counties with a median age of at least 50. **A2**

```{r}
counties_age_50_plus <- md_median_age |>
  filter(estimate >= 50)
```

**Q3** We're interested in knowing more about Montgomery County zip codes where overdose calls are coming from and the demographic characteristics they possess. In particular, we want to calculate a rate of calls per 1,000 population. To do this, you'll need to:
I COULD NOT DOWNLOAD THE CVS I HAVE TRIED RESTARTING R AND RAN EVERYTHING AGAIN AND IT STILL DID NOT WORK.
1.  Load the Montgomery County 911 overdose calls data.
```{r}
overdose_calls <- census_api_key |>

calls_by_zip <-  |>
  county(zipcode, name = "total_calls")

mont_pop <- get_acs(
  geography = "zcta",
  variables = "B01003_001",
  state = "MD",
  year = 2023,
  survey = "acs5"
) |>
  clean_names()

calls_with_pop <- calls_by_zip |>
  left_join(mont_pop, by = c("zipcode" = "geoid")) |>
  mutate(rate_per_1000 = (todal_calls / estimate) * 1000)

```

2.  Create a new dataframe with the total number of calls for each zip code.
```{r}

```

3.  Find the ACS variable pertaining to the total 18 and up population (there are several choices here; you want the simplest one). Then get from the ACS data from all Maryland zip codes using that variable - you will need to specify an earlier year to get the data.
```{r}

```

4.  Join the ACS data to the Montgomery County zip code totals dataframe and rename the estimate column to a meaningful name you've given the ACS variable.
```{r}

```

5.  Add a column to the joined dataframe that calculates a rate of calls per 1,000 population.
```{r}

```


Which zip code has the highest rate of calls? Which has the lowest?

**A3**

```{r}
```

**Q4** Using [CensusReporter.org](https://censusreporter.org/), examine the zip codes with the highest and lowest rates and compare and contrast their demographic profiles. Is there a story here?

**A4**

**Write your answer here:**
I do believe that there is potential for a story here. The zip codes with the highest overdose call rates typically happen in areas with lower median incomes, higher rates of unemployment, and more limited access to healthcare. Those with the lowest rates often show a higher median household incomes and more stable employment rates. Demographically, the high rate zip codes have a younger population that is more racially diverse, and the low rate zipe code are the opposite.
