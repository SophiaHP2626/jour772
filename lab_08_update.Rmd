---
title: "lab_08_update"
author: "Derek Willis/Rob Wells"
date: "2025-10-27"
output: html_document
---

**YOUR NAME HERE:Sophia Hernandez-Pi√±a***


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries and establish settings

**Task** Create a codeblock and load appropriate packages and settings for this lab. We'll be making some charts, working with dates and retrieving Census data.
```{r}
library(tidyverse)
library(lubridate)
library(tidycensus)
library(ggthemes)
```

## Load and modify data

**Task** Create a codeblock and load the following data from the data folder:

-   Prince George's County 911 Overdose Calls

You will need to create columns for the date, week and month based on the existing `datetime` column.

## Questions
```{r}
pg_2022_ODs <- read_csv("data/prince_georges_2022_overdoses.csv")

view(pg_2022_ODs)
```

```{r}
pg_2022_ODs <- pg_2022_ODs |>
  mutate(date = date(datetime), month = month(datetime, label=TRUE), week = week (datetime))
```

**Q1.** Which month saw the greatest percentage of total calls? Create a dataframe that calculates the percentage of all calls that each month's calls represents. Make a bar chart from that dataframe. Your bar chart must have:

-   A clear title that states the main idea/finding
-   Good labels for the x & y axis and a caption for the source, which is Prince George's County EMS.
-   Readable bars - the values shouldn't be overlapping


**A1.**

```{r}
pg_2022_ODs_percents <- pg_2022_ODs |>
group_by(month) |>
  summarize(total_calls = n()) |>
   mutate(pct = (total_calls/sum(total_calls))*100) 
```

```{r}
pg_2022_ODs_percents |>
  ggplot()
```


```{r}
  pg_2022_ODs_percents |>
  ggplot() +
  geom_bar(aes(x=month, weight=pct)) 
```



**A1-written answer: Which month saw the greatest percentage of total calls? Write that here:**
December had the highest percentage of calls at around 10%.

**Q2.** Let's visualize this data on a weekly basis using a line chart. As in Q1, generate a dataframe with the total number of calls for each week, and then create a line chart to show the distribution of calls over time. Your line chart must have:

-   A clear title that states the main idea/finding
-   Good labels for the x & y axis and a caption for the source, which is Prince George's County EMS.
-   Readable labels



**A2.**
```{r}
weekly_calls <- pg_2022_ODs |>
  ggplot() + 
   geom_line(aes(x=datetime, y=total_calls)) 
 scale_x_date(date_breaks = "1 week", date_labels = "%b %d")
```

```{r}
weekly_calls <- pg_2022_ODs |>
  mutate(datetime = as.POSIXct(date),
         week = floor_date(datetime, "week")) |>
  group_by(week) |>
  summarize(total_calls = n())

weekly_calls |>
  ggplot(aes(x = week, y = total_calls)) +
  geom_line(color = "darkblue", size = 1) +
    scale_x_datetime(date_breaks = "1 week", date_labels = "%b %d") +
  labs(
    title = "Weekly Overdose Calls in 2022",
    x = "Week",
    y = "Total Number of Calls",
    caption = "Source: Prince George's County EMS"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


**A2--written answer:Describe the pattern of results; you may want to look at the data to dig into particular outliers.Write that here:**
Throughout the year it fluctuates alot, with a peak in the week of July 11 with over 40 calls, and the lowest of the week on Dec. 27 with less than 10 calls. There are a few weeks unaccounted for which is most likely why this graph slightly contradicts the previous one, however the July statistics do add up as July was the month with the second highest amount of calls at almost 10%.

**Q3.** A scatterplot is a type of chart that helps us see relationships between two variables. One variable goes on the x axis, the other on the y axis. For each row/observation in our data, a scatterplot puts a circle (or a "point") where the two variables intersect on a grid.

Statisticians use scatterplots to show graphically whether one variable is correlated -- related, in a statistical sense -- with another variable. A classic example is the [relationship between ice cream sales and temperature](https://www.mathsisfun.com/data/scatter-xy-plots.html). The scatterplot below -- press play to load the image -- shows that relationship, that an increase in temperature is associated with an increase in ice cream sales. When it's 12C, sales are 200 dollars, and when it's hotter, 25C, sales are 600 dollars.

```{r}
knitr::include_graphics("https://www.mathsisfun.com/data/images/scatter-ice-cream1.svg")
```

We're going to use a scatterplot a little differently, to get a visual sense of two key variables:

Our question is: does the median income in a zip code have any relationship to the number of overdose 911 calls in that zip code?

To answer this question, do the following:

**Q3 - 1.**  Generate a dataframe with the number of 911 calls for each zip code.
```{r}
zipcode_calls <- pg_2022_ODs |>
  group_by(zipcode) |>
  summarize(total_calls = n()) |>
  arrange(desc(total_calls))
```

**Q3 -2.**  Get data from the Census Bureau showing median household income for Maryland zip codes.
```{r}
md_income <- get_acs(
  geography = "zcta",
  variables = "B19013_001",
  year = 2022,
  survey = "acs5"
) |>
  filter(substr(GEOID, 1, 3) %in% c("206", "207", "208", "209", "210", "211", "212")) |>
  rename(
    zipcode = GEOID,
    median_income = estimate,
    margin_of_error = moe
  ) |>
  select(zipcode, median_income, margin_of_error)
```

**Q3 -3.**  Join those two dataframes on their zip code columns, starting with the 911 calls dataframe.
```{r}
zipcode_calls_income <- zipcode_calls |>
  left_join(md_income, by = "zipcode")
```

**Q3 -4.**  Make a scatterplot showing the total calls and median income. I didn't show you how to do this, so look it up! Googling "ggplot scatterplot" is a good start. Give it an appropriate title, source, and x and y axis titles. 
```{r}

zipcode_calls_income |>
  ggplot(aes(x = median_income, y = total_calls)) +
  geom_point(color = "darkblue", size = 3, alpha = 0.7) +
  labs(
    title = "Higher Income Zip Codes Tend to Have Fewer Overdose Calls",
    x = "Median Household Income ($)",
    y = "Total Number of 911 Calls",
    caption = "Sources: Prince George's County EMS, U.S. Census Bureau (2018-2022 ACS)"
  ) +
  scale_x_continuous(labels = scales::dollar_format()) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.caption = element_text(hjust = 0)
  )
```

**Bonus question:** Take the scatterplot above and add a label for each point that shows the zip code using geom_text() - see some examples of its use at <https://ggplot2.tidyverse.org/reference/geom_text.html#ref-examples>. Try to make the names as easy to read as possible by avoiding overlap.

```{r}
zipcode_calls_income |>
  ggplot(aes(x = median_income, y = total_calls)) +
  geom_point(color = "darkblue", size = 3, alpha = 0.7) +
  geom_text(aes(label = zipcode), vjust = -0.5, hjust = 0.5, size = 3, check_overlap = TRUE) +
  labs(
    title = "Higher Income Zip Codes Tend to Have Fewer Overdose Calls",
    x = "Median Household Income ($)",
    y = "Total Number of 911 Calls",
    caption = "Sources: Prince George's County EMS, U.S. Census Bureau (2018-2022 ACS)"
  ) +
  scale_x_continuous(labels = scales::dollar_format()) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.caption = element_text(hjust = 0)
  )
```


**Q4**.  In the answer space below, describe what you see and answer the questions posed above. In a general sense, what do you think this means? Feel free to consider the actual raw values: how would you report out the main point(s) of this chart?

**A4: Write your answer below.**
Based on the scatterplot, the zip codes with lower incomes have way more overdose 911 calls than wealthier areas. This shows that the overdose crisis is hitting poorer communities much harder. Lower-income neighborhoods might have less access to healthcare and addiction treatment, which could explain why they're dealing with more overdose emergencies. This isn't just a health problem, its also about inequality. If we want to tackle the overdose crisis effectively, we need to focus more resources and support on the lower-income zip codes that are being hit the hardest. 
